<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="styles2.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="images/2.png" href="images/2.png">
    <link href="style.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Missed SLA</title>
<title>The Dashboard</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }
    #left-panel {
        background-color: #333;
        color: #fff;
        width: 250px;
        height: 100%;
        position: fixed;
        top: 0;
        left: 0;
        overflow-y: auto;
        padding-top: 20px;
    }
    #left-panel ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    #left-panel ul li {
        padding: 10px 20px;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    #left-panel ul li:hover {
        background-color: #555;
    }
    #content {
        margin-left: 250px;
        padding: 20px;
    }
</style>
</head>
<body>

<div id="left-panel">
    <ul>
        <li onclick="showPage('missedSLA')">Missed SLA</li>
        <li onclick="showPage('dashboardDetails')">Dashboard Details</li>
        <li onclick="showPage('serviceAnalystStats')">Service Analyst Stats</li>
    </ul>
</div>

<div id="content">
    <h2>Welcome to the Dashboard</h2>
    <div id="missedSLA" style="display: none;">
        <h3>Missed SLA Page Content</h3>
        <!-- Add content for Missed SLA page here -->
        <div class="container">
            <div class="row row-cols-2 row-cols-lg-5 g-2 g-lg-3">
              
              <div class="col">
                  <div class="p-3 border bg-light">
                    <label>Customer Name</label>
                    <input type="text" id="CustName" step="any" placeholder="Enter customer name">
                  </div>
              </div>
          
              <div class="col">
                  <div class="p-3 border bg-light">
                    <label>Site Name</label>
                    <input type="text" id="SiteName" step="any" placeholder="Enter Site name">
                  </div>
              </div>
          
              <div class="col">
                  <div class="p-3 border bg-light">
                    <label>Service Manager</label>
                    <input type="text" id="ServName" step="any" placeholder="Enter managers name">
                  </div>
              </div>
          
              <div class="col">
                  <div class="p-3 border bg-light">
                    <label>SLA Target</label>
                    <input type="number" id="SLA_Target" step="any" placeholder="Enter target SLA">
                  </div>
              </div>
          
              <div class="col">
                  <div class="p-3 border bg-light">
                          <label>SIP created?</label> <br>
                          <input type="radio" id="html" name="fav_language" value="HTML">
                  </div>
              </div>
          
              <div class="col">
                <div class="p-3 border bg-light">
                  <label>Site Availability</label>
                  <input type="number" id="siteAvailInput" step="any" placeholder="Enter site Availability" oninput="calculateRemainingTime()">
                </div>
              </div>
          
              <div class="col">
                <div class="p-3 border bg-light">
                  <label>Number of Days</label>
                  <input type="number" id="daysInput" step="any" placeholder="Enter number of days" oninput="calculateRemainingTime()">
                </div>
              </div>
          
              <div class="col">
                <div class="p-3 border bg-light">
                  <label>Total Downtime:</label>
                  <div id="totalDowntimeDiv"> dd:hh:mm</div>
                 <!-- <button onclick="calculateRemainingTime()">Calculate</button> -->
                </div>
              </div>
          
              <div class="col">
                  <div class="p-3 border bg-light">
                    <label>Reason for missing the SLA / Comments</label>
                    <textarea id="story" name="story" rows="5" cols="27"></textarea placeholder="what happened ?">
               
                  </div>
              </div>
          
              <div class="col">
                  <div class="p-3 border bg-light">
                    <label>Missed Reason</label>
                    <input type="text" id="RootC" step="any" placeholder="Root cause">
                  </div>
              </div>
              <script src="script.js"></script>
            </div>
          </div>
          
    </div>
    <!--Dashboard Details-->

    <div id="dashboardDetails" style="display: none;">
        <h3>Dashboard Details Page Content</h3>
        <!-- Add content for Dashboard Details page here -->

        
    <script src="https://www.gstatic.com/firebasejs/5.7.0/firebase.js"></script>
    <script>
        var config = {
            apiKey: "AIzaSyBTm50oSsnWTp4y0S4VL8rAXYowtNfs7aw",
            authDomain: "smmdashboard.firebaseapp.com",  
            databaseURL: "https://smmdashboard-default-rtdb.firebaseio.com",
            projectId: "smmdashboard",
            storageBucket: "smmdashboard.appspot.com",
            messagingSenderId: "810120587469",
        };
        firebase.initializeApp(config);

        function inputData(){
            firebase.database().ref("RepDetails").push({
                
                month:document.getElementById("month").value,
                customerName:document.getElementById("customerName").value,
                serviceManager:document.getElementById("serviceManager").value,
                subordinates:document.getElementById("subordinates").value,
                revenue:document.getElementById("revenue").value,
                numSites:document.getElementById("numSites").value,
                numIncidents:document.getElementById("numIncidents").value,
                missedSLA:document.getElementById("missedSLA").value

            });
            alert('monthly data stored')
        }

    </script>

    <h1>Service Management Monthly report Details</h1>
    <form id="data-entry-form">
        <label for="month">Reporting Month:</label>
        <select id="month" name="month">
            <option value="January">January</option>
            <option value="February">February</option>
            <option value="March">March</option>
            <option value="April">April</option>
            <option value="May">May</option>
            <option value="June">June</option>
            <option value="July">July</option>
            <option value="August">August</option>
            <option value="September">September</option>
            <option value="October">October</option>
            <option value="November">November</option>
            <option value="December">December</option>
           
        </select>

        <label for="customerName">Customer Name:</label>
        <input type="text" id="customerName" name="customerName" required>

        
            <label for="serviceManager">Service M Manager:</label>
            <select id="serviceManager" onchange="updateSubordinates()">
                <option value="">Select a Service M Manager</option>
                <option value="Marlon">Marlon</option>
                <option value="Crystal">Crystal</option>
                <option value="Fathima">Fathima</option>
                <option value="Shohal">Shohal</option>
                <option value="Danie">Danie</option>
                
            </select>
            </select>
    
            <label for="subordinates">Service Manager:</label>
            <select id="subordinates">
                <option value="">Select a Service Manager first</option>
            </select>

        <label for="revenue">Revenue:</label>
        <input type="number" id="revenue" name="revenue" required>

        <label for="numSites">Number of Sites:</label>
        <input type="number" id="numSites" name="numSites" required>

        <label for="numIncidents">Number of Incidents:</label>
        <input type="number" id="numIncidents" name="numIncidents" required>

        <label for="missedSLA">Missed SLAs:</label>
        <input type="number" id="missedSLA" name="missedSLA" required>
        
        <br>
        <button type="button" onclick="inputData()">Store Data</button>
        <br>   
    </form>

    <script>
        function updateSubordinates() {
            const serviceManagerSelect = document.getElementById("serviceManager");
            const subordinatesSelect = document.getElementById("subordinates");
            const serviceManager = serviceManagerSelect.value;

        
            subordinatesSelect.innerHTML = '<option value="">Select a Service Manager first</option>';

          
            const subordinates = {
                "Fathima": ["Neo", "Ivy", "Andries S", "Mohamed P", "Bongi", "Elaine", "Nishal", "Sumaya"],
                "Marlon": ["Christiaan S", "Marko S", "Kevin N", "Pierre M", "Meyer R"],
                "Crystal": ["Andriaan", "Jacques"],
                "Peter ":[],
                "Shohal":["Jose","Immelda","Mahesh","Zuki","Chenese","Noel","Logan"],
                "Danie":["Andriaan","Samuel","Jacques","Sechaba","Sizwe"],

            };

            if (serviceManager in subordinates) {
                const managerSubordinates = subordinates[serviceManager];
                managerSubordinates.forEach(subordinate => {
                    const option = document.createElement("option");
                    option.value = subordinate;
                    option.text = subordinate;
                    subordinatesSelect.appendChild(option);
                });
            }
        }
    </script>
    </div>

    <!-- Admin  Page-->
    <div id="serviceAnalystStats" style="display: none;">
        <h3>Service Analyst Stats Page Content</h3>
        <!-- Add content for Service Analyst Stats page here -->
        <script src="https://www.gstatic.com/firebasejs/5.7.0/firebase.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
        <script>
            var firebaseConfig = {
                apiKey: "AIzaSyBTm50oSsnWTp4y0S4VL8rAXYowtNfs7aw",
                authDomain: "smmdashboard.firebaseapp.com",  
                databaseURL: "https://smmdashboard-default-rtdb.firebaseio.com",
                projectId: "smmdashboard",
                storageBucket: "smmdashboard.appspot.com",
                messagingSenderId: "810120587469",
            };
            firebase.initializeApp(firebaseConfig);
    
            document.addEventListener("DOMContentLoaded", function () {
                const db = firebase.database();
                const dataGridBody = document.getElementById("data-grid-body");
                const filterMonthSelect = document.getElementById("filter-month");
                const filterButton = document.getElementById("filter-button");
                const exportCsvButton = document.getElementById("export-csv-button");
    
                function fetchData() {
                    const selectedMonth = filterMonthSelect.value;
                    dataGridBody.innerHTML = "";
    
                    const repDetailsRef = db.ref("RepDetails");
                    let query = repDetailsRef;
                    if (selectedMonth) {
                        query = query.orderByChild("month").equalTo(selectedMonth);
                    }
    
                    query.once("value", function (snapshot) {
                        snapshot.forEach(function (childSnapshot) {
                            const data = childSnapshot.val();
                            const row = document.createElement("tr");
                            row.innerHTML = `
                                <td>${data.month}</td>
                                <td>${data.customerName}</td>
                                <td>${data.serviceManager}</td>
                                <td>${data.subordinates}</td>
                                <td>${data.revenue}</td>
                                <td>${data.numSites}</td>
                                <td>${data.numIncidents}</td>
                                <td>${data.missedSLA}</td>
                            `;
                            dataGridBody.appendChild(row);
                        });
                    });
                }
    
                filterButton.addEventListener("click", fetchData);
    
                function exportToCsv() {
                    const csvData = [];
                    const headerRow = [];
                    document.querySelectorAll("#data-grid th").forEach((th) => {
                        headerRow.push(th.textContent);
                    });
                    csvData.push(headerRow);
    
                    document.querySelectorAll("#data-grid tbody tr").forEach((row) => {
                        const rowData = [];
                        row.querySelectorAll("td").forEach((cell) => {
                            rowData.push(cell.textContent);
                        });
                        csvData.push(rowData);
                    });
    
                    const csv = Papa.unparse(csvData);
                    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
                    const link = document.createElement("a");
                    if (link.download !== undefined) {
                        const url = URL.createObjectURL(blob);
                        link.setAttribute("href", url);
                        link.setAttribute("download", "SMMData.csv");
                        link.style.visibility = "hidden";
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                }
    
                exportCsvButton.addEventListener("click", exportToCsv);
    
                
                const months = ["", "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                const filterMonthOptions = months.map(month => `<option value="${month}">${month}</option>`);
                filterMonthSelect.innerHTML = filterMonthOptions.join("");
    
              
                fetchData();
            });
        </script>
    
        <h1>Annual Report Information</h1>
        <form id="data-entry-form"> 
        </form>
    
        <div id="data-grid">
            <h2>Detailed Report Information</h2>
            <label for="filter-month">Filter by Month:</label>
            <select id="filter-month"></select>
            <button id="filter-button">Filter</button>
            <button id="export-csv-button"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAXklEQVR4nGNgwA6mMDAw/IfSRIMpw0iTFgMDw0wGBoYrUE1XoHyQOF6wDqoBhjczMDAwEtIkwMDA8ACq4TEDA4MwsX4yZ2Bg+MbAwGBDrAYY0CZVA0EgSAZGCSmiMADl6iWZRO9CSwAAAABJRU5ErkJggg=="></button>
            <table>
                <thead>
                    <tr>
                        <th>Month</th>
                        <th>Customer Name</th>
                        <th>Service M Manager</th>
                        <th>Service Manager</th>
                        <th>Revenue</th>
                        <th>Number of Sites</th>
                        <th>Number of Incidents</th>
                        <th>Missed SLAs</th>
                    </tr>
                </thead>
                <tbody id="data-grid-body">
                   
                </tbody>
            </table>
        </div>

    </div>
</div>

<script>
    function showPage(pageName) {
        var pages = document.querySelectorAll('#content > div');
        pages.forEach(function(page) {
            if (page.id === pageName) {
                page.style.display = 'block';
            } else {
                page.style.display = 'none';
            }
        });
    }
</script>

</body>
</html>
